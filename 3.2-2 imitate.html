<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>Document</title>
</head>
<body>
    <div id="root">
        <div>
            <div>
                <div>
                    <p>{{name}}--{{message}}</p>
                </div>
            </div>
        </div>
        <p>{{name}}</p>
        <p>{{message}}</p>
    </div>

    <script>

        let reg = /\{\{(.+?)\}\}/g;

        /** 步骤拆解
         * 1. 拿到模板
         * 2. 拿到数据（data）
         * 3. 将数据与模板结合
         * 4. 放到页面中
        **/

        // 1.
        let tmpNode = document.querySelector('#root');

        // 2.
        let data = {
            name: '新的Name',
            message: '新的消息'
        }

        // 3.
        // 一般使用递归
        // 本案例中 template 是 DOM 元素
        // Vue 源码中是 DOM -> 字符串模板 -> VNode(虚拟 DOM) -> 真正的 DOM
        function compiler(template, data) {

            let childNodes = template.childNodes;

            for(let i = 0; i < childNodes.length; i++) {

                let type = childNodes[i].nodeType; // 1 元素 3 文本

                // 文本节点，里面可能有插值
                if(type == 3) {

                    let txt = childNodes[i].nodeValue; // 该元素只有文本节点才有意义

                    // 判断有没有双花括号
                    txt = txt.replace(reg, (_, g) => { // replace 使用正则匹配一次，函数就会被调用一次
                                                 // 函数的第0个参数表示匹配到的内容
                                                 // 函数的第n个参数表示正则的第n组
                        let key = g.trim();

                        let value = data[key];

                        // 将 {{ xxx }} 用 value 替换
                        return value;

                    });

                    // 注意：现在 txt 和 DOM 元素是没有关系的，需重新赋值
                    childNodes[i].nodeValue = txt;

                }

                // 元素节点，递归
                if(type == 1) {

                    compiler(childNodes[i], data);

                }   

            }

        }

        let generateNode = tmpNode.cloneNode(true); // 注意这里是 DOM 元素，可以这么用，虚拟 DOM 不行

        console.log(tmpNode);
        compiler(generateNode, data);
        console.log(generateNode);

        // 此时并没有生成新的 template， 所以页面中看到的是更新后的数据，因为 DOM 是引用类型
        // 这样模板就没了，无法做到响应式

        // 4
        root.parentNode.replaceChild(generateNode, root);

        /** 这只是极简的情况
         * 1.Vue 使用的是 虚拟 DOM
         * 2.只考虑了单属性 {{name}}，而 Vue 中大量使用层级 {{ item.name.firstName }}
         * 3.代码没有整合
        */


    </script>
</body>
</html>